---
title: "Visualization of Loss Functions"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Visualization of Loss Functions}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  dpi = 150,
  dev = "png",
  out.width = "100%",
  fig.retina = 2
)
```

# Loss Functions

```{r, message=FALSE}
library(vistool)
```

The `VisualizerLossFunction` class visualizes loss functions.
Loss functions are wrapped in `LossFunction` objects.
The package includes a few predefined loss functions that are used for classification and regression.

```{r}
as.data.table(dict_loss)
```

To get a loss function from the dictionary, use the `lss()` function.
Many loss functions support parameters (e.g., `quantile` for pinball loss, `delta` for Huber loss, `epsilon` for epsilon-insensitive loss).
You can specify these parameters directly in the `lss()` function call.
Here we retrieve the pinball loss function for regression with a custom quantile parameter.

```{r}
loss_function <- lss("pinball", quantile = 0.3)
```

# Visualization

To visualize the loss function, use the `as_visualizer()` function.
The `y_pred` arguments contains $y - f(x)$ (for regression losses) and `y_true` the true value $y$.
By default, loss functions are plotted with 1000 points for smooth curves.

```{r}
vis <- as_visualizer(loss_function, y_pred = seq(-4, 4), y_true = 0)
```

Use the `plot()` method to plot the loss function.

```{r, out.width='100%'}
vis$plot()
```

# Regression Loss Functions

Here we visualize multiple regression loss functions:

```{r, echo=TRUE, message=FALSE, warning=FALSE, out.width='100%'}
loss_huber = lss("huber")
loss_l2 = lss("l2_se")
loss_l1 = lss("l1_ae")
loss_logcosh = lss("log-cosh")

vis_combined = VisualizerLossFuns$new(
  list(loss_huber, loss_l2, loss_l1, loss_logcosh),
  y_pred = seq(-4, 4),
  y_true = 0,
  n_points = 5000L  # higher resolution for smooth curves
)
vis_combined$plot()
```

# Classification Loss Functions

Here we visualize classification loss functions, where `y_pred` contains $y * f(x)$:

```{r, echo=FALSE, message=FALSE, warning=FALSE, out.width='100%'}
loss_hinge <- lss("cross-entropy")
loss_crossentropy <- lss("hinge")

vis_combined = VisualizerLossFuns$new(
  list(loss_hinge, loss_crossentropy),
  y_pred = seq(-4, 4),
  y_true = 1
)
vis_combined$plot()
```

# Custom Loss Functions

We can also define and visualize custom loss functions:

```{r, echo=TRUE, message=FALSE, warning=FALSE, out.width='100%'}
custom_loss <- LossFunction$new(
  id = "custom_loss",
  label = "Sinusoidal-Exponential Loss",
  task_type = "regr",
  fun = function(r) abs(r) * exp(-abs(r) / 3) + 0.5 * sin(2 * r)
)

vis <- as_visualizer(custom_loss, y_pred = seq(-10, 10), y_true = 0, n_points = 5000L)
vis$plot()
```
