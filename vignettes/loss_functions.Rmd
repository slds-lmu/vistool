---
title: "Visualization of Loss Functions"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Visualization of Loss Functions}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

# Loss Functions

```{r, message=FALSE}
library(vistool)
```

The `VisualizerLossFunction` class visualizes loss functions.
Loss functions are wrapped in `LossFunction` objects.
The package includes a few predefined loss functions that are used for classification and regression.

```{r}
as.data.table(dict_loss)
```

To get a loss function from the dictionary, use the `lss()` function
We retrieve the hinge loss function for classification.

```{r}
loss_function <- lss("hinge")
```

# Visualization

To visualize the loss function, use the `as_visualizer()` function.
The `y_pred` arguments contains $y * f(x)$ and `y_true` the true value $y$.

```{r}
vis <- as_visualizer(loss_function, y_pred = seq(-4, 4), y_true = 1)
```

Use the `plot()` method to plot the loss function.

```{r, out.width='100%'}
vis$plot()
```

# Regression Loss Functions

Here we visualize multiple regression loss functions:

```{r, echo=FALSE, message=FALSE, warning=FALSE, out.width='100%'}
library(mlr3misc)
library(ggplot2)

# Create individual plots for each loss function
plots <- list()
loss_names <- c("huber", "l1_ae", "l2_se", "log-cosh")

for (i in seq_along(loss_names)) {
  key <- loss_names[i]
  loss_func <- lss(key)
  vis <- as_visualizer(loss_func, y_pred = seq(-10, 10), y_true = 0)
  plots[[i]] <- vis$plot() + ggplot2::ggtitle(loss_func$label)
}

# Combine plots using patchwork if available, or just show them individually
if (requireNamespace("patchwork", quietly = TRUE)) {
  patchwork::wrap_plots(plots, ncol = 2)
} else {
  # If patchwork is not available, just show the first plot as an example
  plots[[1]]
}
```

# Classification Loss Functions

Here we visualize classification loss functions:

```{r, echo=FALSE, message=FALSE, warning=FALSE, out.width='100%'}
# Create individual plots for each loss function
plots <- list()
loss_names <- c("cross-entropy", "hinge")

for (i in seq_along(loss_names)) {
  key <- loss_names[i]
  loss_func <- lss(key)
  vis <- as_visualizer(loss_func, y_pred = seq(-4, 4), y_true = 1)
  plots[[i]] <- vis$plot() + ggplot2::ggtitle(loss_func$label)
}

# Combine plots using patchwork if available, or just show them individually
if (requireNamespace("patchwork", quietly = TRUE)) {
  patchwork::wrap_plots(plots, ncol = 2)
} else {
  # If patchwork is not available, just show the first plot as an example
  plots[[1]]
}
```

# Custom Loss Functions

We can also define and visualize custom loss functions:

```{r, echo=TRUE, message=FALSE, warning=FALSE, out.width='100%'}
custom_loss <- LossFunction$new(
  id = "custom_loss",
  label = "Sinusoidal-Exponential Loss",
  task_type = "regr",
  fun = function(r) abs(r) * exp(-abs(r) / 3) + 0.5 * sin(2 * r)
)

vis <- as_visualizer(custom_loss, y_pred = seq(-10, 10), y_true = 0)
vis$plot()
```
